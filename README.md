# traffic_light_detector
Kaggle соревнование:  [Traffic Light Detection](https://www.kaggle.com/competitions/traffic-light-detection-and-classification/overview)
Результат: 3-е место (Ruslan Salikhzianov), mAP = 0.4832

## Описание соревнования
Целью соревнования является создание детектора светофоров на изображении. Представлены тренировочный и валидационный наборы изображений и меток, а также представлен набор изображений для тестирования модели в соревновании.

Пример изображений с нарисованными боксами:

Метки представлены в xml-файлах, содержащие информацию о каждом отдельном изображении: наименование изображения, размер, абсолютные координаты боксов в изображении (в формате XYXY) и другие.

В качестве метрики используется mean Average Precision (mAP). С помощью представленного алгоритма была достигнута mAP = 0.4832 на тестовом наборе, благодаря чему удалось достичь в соревновании 3-й позиции в leaderboard.

## О модели
В качестве архитектуры модели используется [yolov9-e](https://github.com/WongKinYiu/yolov9/tree/93f1a2829870a37b306115012f34804017cba01b).  

Обучение производилось на GPU A100. Лучший результат был получен при стандартных параметрах модели из коробки. Время обучения составило ~1.5 часа.

Параметры обучения:
- image size: 720px
- batch size: 18
- epochs: 30
- close-mosaic: 3

Более подробную информацию о подготовке данных и обучении модели можно найти в [Colab](https://colab.research.google.com/drive/1kPhc_eBkDdBJc-jSKbmOh-BMcxfJA3ra?usp=sharing), где непосредственно и производилось обучение.

## Получить предсказание
1. Создать окружение с Python 3.10.12
2. Клонировать проект: https://github.com/salih-ds/traffic_light_detector.git
3. Загрузить требуемые модули:
```
pip install -r requirements.txt -q
```
4. Загрузить веса для детектора:
```
python load_weights.py
```
5. Добавить изображения в папку images, для которых необходимо выполнить предсказание. С помощью кода ниже можно загрузить 10 изображений из тестового набора соревнования:
```
python load_test_images.py
```
6. Выполнить предсказание:
```
bash detect.sh
```

После выполнения предсказания результат будет помещен в папке results/exp, где будут представлены поданные в модель изображения с нарисованными на них боксами и вероятностью класса, и, там же в папке labels представлены txt-файлы с относительными координатами боксов и вероятности принадлежности к классу отдельно для каждого изображения.

Пример строки txt:
*0 0.371875 0.0805556 0.0234375 0.1 0.807324*
где через пробел представлены поля соответственно:
- предсказанный класс (0)
- центр бокса по оси X (0.371875)
- центр бокса по оси Y (0.0805556)
- ширина бокса (0.0234375)
- высота бокса (0.1)
- вероятность принадлежности к классу (0.807324)